<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ダッシュボード - 資産管理</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Hiragino Sans", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 16px;
            padding-bottom: 80px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* ヘッダー */
        .header {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .user-name {
            font-size: 24px;
            font-weight: 700;
            color: #333;
        }

        .btn-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 16px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e9ecef;
        }

        /* 合計資産表示 */
        .total-assets {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%);
            border-radius: 16px;
            margin-bottom: 16px;
        }

        .total-label {
            font-size: 16px;
            color: #666;
            margin-bottom: 8px;
        }

        .total-amount {
            font-size: 42px;
            font-weight: 800;
            color: #333;
            margin-bottom: 12px;
        }

        .profit-info {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .profit-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .profit-label {
            font-size: 12px;
            color: #888;
        }

        .profit-value {
            font-size: 18px;
            font-weight: 700;
        }

        .profit-value.positive {
            color: #dc3545;
        }

        .profit-value.negative {
            color: #28a745;
        }

        /* 資産カードグリッド */
        .asset-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }

        .asset-card {
            background: white;
            border-radius: 16px;
            padding: 16px 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            gap: 8px;
            transition: all 0.3s ease;
            position: relative;
            min-height: 200px;
            cursor: pointer;
        }

        .asset-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }

        .card-icon {
            width: 56px;
            height: 56px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 4px;
        }

        .icon-jp { background: linear-gradient(135deg, #ffe5e5 0%, #ffd5d5 100%); }
        .icon-us { background: linear-gradient(135deg, #e5f0ff 0%, #d5e5ff 100%); }
        .icon-cash { background: linear-gradient(135deg, #fff4e5 0%, #ffe5d5 100%); }
        .icon-gold { background: linear-gradient(135deg, #fff9e5 0%, #fff0d5 100%); }
        .icon-crypto { background: linear-gradient(135deg, #f5e5ff 0%, #e5d5ff 100%); }
        .icon-trust { background: linear-gradient(135deg, #e5fff5 0%, #d5ffe5 100%); }
        .icon-insurance { background: linear-gradient(135deg, #e5f9ff 0%, #d5f0ff 100%); }

        .card-info {
            display: flex;
            flex-direction: column;
            gap: 6px;
            font-size: 13px;
            margin-top: 4px;
        }

        .info-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
            min-height: 24px;
        }

        .info-label {
            color: #888;
            font-size: 11px;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: 40px;
        }

        .info-value {
            display: flex;
            align-items: center;
            gap: 4px;
            flex: 1;
            justify-content: flex-end;
        }

        .info-amount {
            font-weight: 600;
            font-size: 13px;
            white-space: nowrap;
        }

        .info-amount.positive {
            color: #dc3545;
        }

        .info-amount.negative {
            color: #28a745;
        }

        .info-percentage-badge {
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            color: white;
            white-space: nowrap;
            min-width: 45px;
            text-align: center;
        }

        .info-percentage-badge.positive {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .info-percentage-badge.negative {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
        }

        .info-percentage-badge.zero {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        .card-name {
            font-size: 15px;
            font-weight: 600;
            color: #666;
            text-align: center;
            margin: 6px 0 4px;
        }

        .card-amount {
            font-size: 22px;
            font-weight: 700;
            text-align: center;
            color: #333;
            margin-top: auto;
            padding-top: 4px;
        }

        .badge-percentage {
            position: absolute;
            top: 12px;
            right: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 700;
            color: white;
            white-space: nowrap;
        }

        .badge-percentage.positive {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }

        .badge-percentage.negative {
            background: linear-gradient(135deg, #28a745 0%, #218838 100%);
        }

        .badge-percentage.zero {
            background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%);
        }

        /* グラフセクション */
        .chart-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-title {
            font-size: 20px;
            font-weight: 700;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 20px;
        }

        /* フッター */
        .footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            padding: 12px 16px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            z-index: 1000;
        }

        .footer-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            color: #666;
            font-size: 12px;
            transition: all 0.3s ease;
        }

        .footer-btn:hover, .footer-btn.active {
            color: #667eea;
        }

        .footer-icon {
            font-size: 24px;
        }

        /* レスポンシブ */
        @media (max-width: 480px) {
            .asset-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 10px;
            }

            .asset-card {
                padding: 14px 10px;
                min-height: 190px;
            }

            .card-icon {
                width: 52px;
                height: 52px;
                font-size: 26px;
            }

            .card-name {
                font-size: 14px;
            }

            .card-amount {
                font-size: 20px;
            }

            .info-label {
                font-size: 10px;
                min-width: 38px;
            }

            .info-amount {
                font-size: 12px;
            }

            .info-percentage-badge {
                padding: 2px 5px;
                font-size: 9px;
                min-width: 42px;
            }

            .badge-percentage {
                padding: 3px 7px;
                font-size: 10px;
            }

            .user-name {
                font-size: 20px;
            }

            .total-amount {
                font-size: 36px;
            }

            .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
        }

        @media (min-width: 481px) and (max-width: 768px) {
            .asset-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (min-width: 769px) {
            .asset-grid {
                grid-template-columns: repeat(4, 1fr);
                gap: 16px;
            }

            .asset-card {
                padding: 20px 16px;
            }
        }

        /* アラート */
        .alert {
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 12px;
            font-weight: 600;
            text-align: center;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }
    </style>
</head>
<body>
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert {% if category == 'error' %}alert-error{% else %}alert-success{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="container">
        <!-- ヘッダー -->
        <div class="header">
            <div class="header-top">
                <div class="user-name">👋 {{ user_name }}</div>
                <div class="btn-group">
                    <!-- ✅ 修正: assets.update_all_prices -->
                    <form action="{{ url_for('assets.update_all_prices') }}" method="POST" style="display: inline;">
                        <button type="submit" class="btn btn-primary">🔄 更新</button>
                    </form>
                    <!-- ✅ 修正: auth.logout -->
                    <a href="{{ url_for('auth.logout') }}" class="btn btn-secondary">ログアウト</a>
                </div>
            </div>

            <!-- 合計資産 -->
            <div class="total-assets">
                <div class="total-label">総資産</div>
                <div class="total-amount">¥{{ "{:,.0f}".format(total_assets) }}</div>
                <div class="profit-info">
                    <div class="profit-item">
                        <div class="profit-label">損益</div>
                        <div class="profit-value {% if total_profit >= 0 %}positive{% else %}negative{% endif %}">
                            {{ '+' if total_profit >= 0 else '' }}¥{{ "{:,.0f}".format(total_profit) }}
                            {% if total_assets - total_profit > 0 %}
                            ({{ '+' if total_profit >= 0 else '' }}{{ "{:.1f}".format((total_profit / (total_assets - total_profit)) * 100) }}%)
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 資産カードグリッド -->
        <div class="asset-grid">
            <!-- 日本株 -->
            <!-- ✅ 修正: assets.manage_assets -->
            <a href="{{ url_for('assets.manage_assets', asset_type='jp_stock') }}" style="text-decoration: none;">
                <div class="asset-card">
                    {% if jp_profit != 0 %}
                    <span class="badge-percentage {% if jp_profit > 0 %}positive{% elif jp_profit < 0 %}negative{% else %}zero{% endif %}">
                        {{ '+' if jp_profit >= 0 else '' }}{{ "{:.1f}".format((jp_profit / jp_cost * 100) if jp_cost > 0 else 0) }}%
                    </span>
                    {% endif %}
                    <div class="card-icon icon-jp">🇯🇵</div>
                    <div class="card-info">
                        <div class="info-row">
                            <span class="info-label">損益</span>
                            <div class="info-value">
                                <span class="info-amount {% if jp_profit > 0 %}positive{% elif jp_profit < 0 %}negative{% endif %}">
                                    {{ '+' if jp_profit >= 0 else '' }}¥{{ "{:,.0f}".format(jp_profit) }}
                                </span>
                                {% if jp_cost > 0 %}
                                <span class="info-percentage-badge {% if jp_profit > 0 %}positive{% elif jp_profit < 0 %}negative{% else %}zero{% endif %}">
                                    {{ '+' if jp_profit >= 0 else '' }}{{ "{:.1f}".format((jp_profit / jp_cost) * 100) }}%
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">前日比</span>
                            <div class="info-value">
                                <span class="info-amount">¥0</span>
                                <span class="info-percentage-badge zero">0.0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-name">日本株</div>
                    <div class="card-amount">¥{{ "{:,.0f}".format(jp_total) }}</div>
                </div>
            </a>

            <!-- 米国株 -->
            <a href="{{ url_for('assets.manage_assets', asset_type='us_stock') }}" style="text-decoration: none;">
                <div class="asset-card">
                    {% if us_profit_jpy != 0 %}
                    <span class="badge-percentage {% if us_profit_jpy > 0 %}positive{% elif us_profit_jpy < 0 %}negative{% else %}zero{% endif %}">
                        {{ '+' if us_profit_jpy >= 0 else '' }}{{ "{:.1f}".format((us_profit_jpy / (us_total_jpy - us_profit_jpy) * 100) if (us_total_jpy - us_profit_jpy) > 0 else 0) }}%
                    </span>
                    {% endif %}
                    <div class="card-icon icon-us">🇺🇸</div>
                    <div class="card-info">
                        <div class="info-row">
                            <span class="info-label">損益</span>
                            <div class="info-value">
                                <span class="info-amount {% if us_profit_jpy > 0 %}positive{% elif us_profit_jpy < 0 %}negative{% endif %}">
                                    {{ '+' if us_profit_jpy >= 0 else '' }}¥{{ "{:,.0f}".format(us_profit_jpy) }}
                                </span>
                                {% if (us_total_jpy - us_profit_jpy) > 0 %}
                                <span class="info-percentage-badge {% if us_profit_jpy > 0 %}positive{% elif us_profit_jpy < 0 %}negative{% else %}zero{% endif %}">
                                    {{ '+' if us_profit_jpy >= 0 else '' }}{{ "{:.1f}".format((us_profit_jpy / (us_total_jpy - us_profit_jpy)) * 100) }}%
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">前日比</span>
                            <div class="info-value">
                                <span class="info-amount">¥0</span>
                                <span class="info-percentage-badge zero">0.0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-name">米国株</div>
                    <div class="card-amount">¥{{ "{:,.0f}".format(us_total_jpy) }}</div>
                </div>
            </a>

            <!-- 現金 -->
            <a href="{{ url_for('assets.manage_assets', asset_type='cash') }}" style="text-decoration: none;">
                <div class="asset-card">
                    <div class="card-icon icon-cash">💰</div>
                    <div class="card-info">
                        <div class="info-row">
                            <span class="info-label">項目数</span>
                            <div class="info-value">
                                <span class="info-amount">{{ cash_items|length }}件</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-name">現金</div>
                    <div class="card-amount">¥{{ "{:,.0f}".format(cash_total) }}</div>
                </div>
            </a>

            <!-- 金 -->
            <a href="{{ url_for('assets.manage_assets', asset_type='gold') }}" style="text-decoration: none;">
                <div class="asset-card">
                    {% if gold_profit != 0 %}
                    <span class="badge-percentage {% if gold_profit > 0 %}positive{% elif gold_profit < 0 %}negative{% else %}zero{% endif %}">
                        {{ '+' if gold_profit >= 0 else '' }}{{ "{:.1f}".format((gold_profit / gold_cost * 100) if gold_cost > 0 else 0) }}%
                    </span>
                    {% endif %}
                    <div class="card-icon icon-gold">🪙</div>
                    <div class="card-info">
                        <div class="info-row">
                            <span class="info-label">損益</span>
                            <div class="info-value">
                                <span class="info-amount {% if gold_profit > 0 %}positive{% elif gold_profit < 0 %}negative{% endif %}">
                                    {{ '+' if gold_profit >= 0 else '' }}¥{{ "{:,.0f}".format(gold_profit) }}
                                </span>
                                {% if gold_cost > 0 %}
                                <span class="info-percentage-badge {% if gold_profit > 0 %}positive{% elif gold_profit < 0 %}negative{% else %}zero{% endif %}">
                                    {{ '+' if gold_profit >= 0 else '' }}{{ "{:.1f}".format((gold_profit / gold_cost) * 100) }}%
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">前日比</span>
                            <div class="info-value">
                                <span class="info-amount">¥0</span>
                                <span class="info-percentage-badge zero">0.0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-name">金(Gold)</div>
                    <div class="card-amount">¥{{ "{:,.0f}".format(gold_total) }}</div>
                </div>
            </a>

            <!-- 暗号資産 -->
            <a href="{{ url_for('assets.manage_assets', asset_type='crypto') }}" style="text-decoration: none;">
                <div class="asset-card">
                    {% if crypto_profit != 0 %}
                    <span class="badge-percentage {% if crypto_profit > 0 %}positive{% elif crypto_profit < 0 %}negative{% else %}zero{% endif %}">
                        {{ '+' if crypto_profit >= 0 else '' }}{{ "{:.1f}".format((crypto_profit / crypto_cost * 100) if crypto_cost > 0 else 0) }}%
                    </span>
                    {% endif %}
                    <div class="card-icon icon-crypto">₿</div>
                    <div class="card-info">
                        <div class="info-row">
                            <span class="info-label">損益</span>
                            <div class="info-value">
                                <span class="info-amount {% if crypto_profit > 0 %}positive{% elif crypto_profit < 0 %}negative{% endif %}">
                                    {{ '+' if crypto_profit >= 0 else '' }}¥{{ "{:,.0f}".format(crypto_profit) }}
                                </span>
                                {% if crypto_cost > 0 %}
                                <span class="info-percentage-badge {% if crypto_profit > 0 %}positive{% elif crypto_profit < 0 %}negative{% else %}zero{% endif %}">
                                    {{ '+' if crypto_profit >= 0 else '' }}{{ "{:.1f}".format((crypto_profit / crypto_cost) * 100) }}%
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">前日比</span>
                            <div class="info-value">
                                <span class="info-amount">¥0</span>
                                <span class="info-percentage-badge zero">0.0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-name">暗号資産</div>
                    <div class="card-amount">¥{{ "{:,.0f}".format(crypto_total) }}</div>
                </div>
            </a>

            <!-- 投資信託 -->
            <a href="{{ url_for('assets.manage_assets', asset_type='investment_trust') }}" style="text-decoration: none;">
                <div class="asset-card">
                    {% if investment_trust_profit != 0 %}
                    <span class="badge-percentage {% if investment_trust_profit > 0 %}positive{% elif investment_trust_profit < 0 %}negative{% else %}zero{% endif %}">
                        {{ '+' if investment_trust_profit >= 0 else '' }}{{ "{:.1f}".format((investment_trust_profit / investment_trust_cost * 100) if investment_trust_cost > 0 else 0) }}%
                    </span>
                    {% endif %}
                    <div class="card-icon icon-trust">📊</div>
                    <div class="card-info">
                        <div class="info-row">
                            <span class="info-label">損益</span>
                            <div class="info-value">
                                <span class="info-amount {% if investment_trust_profit > 0 %}positive{% elif investment_trust_profit < 0 %}negative{% endif %}">
                                    {{ '+' if investment_trust_profit >= 0 else '' }}¥{{ "{:,.0f}".format(investment_trust_profit) }}
                                </span>
                                {% if investment_trust_cost > 0 %}
                                <span class="info-percentage-badge {% if investment_trust_profit > 0 %}positive{% elif investment_trust_profit < 0 %}negative{% else %}zero{% endif %}">
                                    {{ '+' if investment_trust_profit >= 0 else '' }}{{ "{:.1f}".format((investment_trust_profit / investment_trust_cost) * 100) }}%
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">前日比</span>
                            <div class="info-value">
                                <span class="info-amount">¥0</span>
                                <span class="info-percentage-badge zero">0.0%</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-name">投資信託</div>
                    <div class="card-amount">¥{{ "{:,.0f}".format(investment_trust_total) }}</div>
                </div>
            </a>

            <!-- 保険 -->
            <a href="{{ url_for('assets.manage_assets', asset_type='insurance') }}" style="text-decoration: none;">
                <div class="asset-card">
                    {% if insurance_profit != 0 %}
                    <span class="badge-percentage {% if insurance_profit > 0 %}positive{% elif insurance_profit < 0 %}negative{% else %}zero{% endif %}">
                        {{ '+' if insurance_profit >= 0 else '' }}{{ "{:.1f}".format((insurance_profit / insurance_cost * 100) if insurance_cost > 0 else 0) }}%
                    </span>
                    {% endif %}
                    <div class="card-icon icon-insurance">🛡️</div>
                    <div class="card-info">
                        <div class="info-row">
                            <span class="info-label">損益</span>
                            <div class="info-value">
                                <span class="info-amount {% if insurance_profit > 0 %}positive{% elif insurance_profit < 0 %}negative{% endif %}">
                                    {{ '+' if insurance_profit >= 0 else '' }}¥{{ "{:,.0f}".format(insurance_profit) }}
                                </span>
                                {% if insurance_cost > 0 %}
                                <span class="info-percentage-badge {% if insurance_profit > 0 %}positive{% elif insurance_profit < 0 %}negative{% else %}zero{% endif %}">
                                    {{ '+' if insurance_profit >= 0 else '' }}{{ "{:.1f}".format((insurance_profit / insurance_cost) * 100) }}%
                                </span>
                                {% endif %}
                            </div>
                        </div>
                        <div class="info-row">
                            <span class="info-label">項目数</span>
                            <div class="info-value">
                                <span class="info-amount">{{ insurance_items|length }}件</span>
                            </div>
                        </div>
                    </div>
                    <div class="card-name">保険</div>
                    <div class="card-amount">¥{{ "{:,.0f}".format(insurance_total) }}</div>
                </div>
            </a>
        </div>

        <!-- グラフセクション -->
        <div class="chart-section">
            <div class="chart-title">資産構成</div>
            <div class="chart-container">
                <canvas id="assetChart"></canvas>
            </div>
        </div>

        <div class="chart-section">
            <div class="chart-title">資産推移</div>
            <div class="chart-container">
                <canvas id="historyChart"></canvas>
            </div>
        </div>
    </div>

    <!-- フッター -->
    <div class="footer">
        <!-- ✅ 修正: dashboard.dashboard -->
        <a href="{{ url_for('dashboard.dashboard') }}" class="footer-btn active">
            <div class="footer-icon">🏠</div>
            <div>ホーム</div>
        </a>
        <a href="#" class="footer-btn">
            <div class="footer-icon">📊</div>
            <div>資産</div>
        </a>
        <a href="#" class="footer-btn">
            <div class="footer-icon">⚙️</div>
            <div>設定</div>
        </a>
    </div>

    <script>
        // 資産構成円グラフ
        const chartData = {{ chart_data|safe }};
        const ctx1 = document.getElementById('assetChart').getContext('2d');
        new Chart(ctx1, {
            type: 'doughnut',
            data: {
                labels: chartData.labels,
                datasets: [{
                    data: chartData.values,
                    backgroundColor: [
                        '#FF6384',
                        '#36A2EB',
                        '#FFCE56',
                        '#4BC0C0',
                        '#9966FF',
                        '#FF9F40',
                        '#C9CBCF'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                }
            }
        });

        // 資産推移グラフ
        const historyData = {{ history_data|safe }};
        const ctx2 = document.getElementById('historyChart').getContext('2d');
        new Chart(ctx2, {
            type: 'line',
            data: {
                labels: historyData.dates,
                datasets: [{
                    label: '総資産',
                    data: historyData.total,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        ticks: {
                            callback: function(value) {
                                return '¥' + value.toLocaleString();
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
